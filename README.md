# API_ABC.Data

## Заведение сегментов на сбор данных.
Создание, редактирование и отключение сегментов основано на передаче актуального json-файла.

Актуальный файл необходимо отправить post-запросом с интервале с 00:00 до 16:00 (по МСК) для актуализации состава сегментов и получения данных на следующий день.

#### Пример:

*Вчера вы передали сегменты: 1-seg, 2- seg, 3-seg. Сегодня вы передали: 1-seg, 4- seg, 5-seg.*

***Логика:***

*2- seg, 3-seg – отключатся и завтра данных по ним не будет, а 1-seg, 4- seg и 5-seg новые сегменты на сбор. При этом, в 1-seg обновятся данные из списка доменов, номеров или альфа-имен.*

#### Структура json-файла:
- project_name — произвольное название сегмента
- source – источник сбора данных: «mts», «megafon», «beeline» или «tele2»
- list_of_domains – список доменов
- list_of_phones – список номеров
- list_of_alpha – список альфа-имен отправителей СМС
- depth — глубина в днях на которую смотрится активность по триггерам из списков list_of_domains, list_of_phones, list_of_alpha (целое число)
- min_n — минимальное необходимое количество срабатываний любых триггеров из списков list_of_domains, list_of_phones, list_of_alpha (целое число)
- limit — максимальное количество идентификаторов по данному project_name в день.

#### Требования:
- Кодировка utf-8
- Название сегмента должно состоять из чисел и букв латинского алфавита длиной не более 5 символов.
- Указывается 1 источник данных: «mts», «megafon», «beeline» или «tele2»
- Указывать только 1 тип данных при сборе сегментов: домены или номера или альфа-имена.
- Необходимо указывать не менее 5 номеров или альфа-имен
- В случае указания доменов, необходимо не менее 5 уникальных доменов 2-го уровня.
- Лимит сегмента не должен быть от 10 номеров

***Пример json:***
```
[
    {
        «project_name»: «project_name»,
        «source»: «mts»,
        «list_of_domains»: [«xx.com», «yy.ru», «zz.net», …],
        «list_of_numbers»: [«74951112233», «74991112233», «79031112233», …],
        «list_of_alpha»: [«Tods», «Motr», …],
        «depth»: 10,
        «min_n»: 2,
        «limit»: 750
    },
    ...
]
```
***PHP пример post-отправки данных:***
```
$content = “[{ json }]”;
$url = https://admin.abc-data.ru/api/?key=ZlXfvEd_fdbB45sB1CsB753%4Jbvd2ECE7q4f6rz0dffdAREHN48;

$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER, array("Content-type: application/json"));
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_POST, true);
curl_setopt($curl, CURLOPT_POSTFIELDS, $content);

$json_response = curl_exec($curl);
$status = curl_getinfo($curl, CURLINFO_HTTP_CODE);
curl_close($curl);
```
Рабочий URL для отправки и обработки данных будет отправлен по запросу. В случае успешного получения и обработки json-файла, сервер вернет 200="OK".

## Структура отправки данных
Данные отправляются post-запросом в json-формате.

***Пример:***
```
[
    {
        «project_name»: «A416»,
        «phone»: [
            «79632043575»,
            «79633115361»,
            «79632018801»,
            «79632043575»,
            «79633115361»,
            «79632018801»
        ]
    },
    ...
]
```

***Структура json-файла:***
- project_name — название сегмента
- phone – список номеров

Данные отправляются сразу как получен ответ от оператора. Так как каждый оператор отправляет данные в свое время, данные будут отправляться по каждому оператору в отдельности.
